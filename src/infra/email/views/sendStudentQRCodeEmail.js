import NodeMailer from '../nodemailer.js';

import { generateStudentQRCode } from '../../../utils/generateStudentQRCode.js';

async function sendStudentQRCodeEmail(studentData) {
  const QRCode = await generateStudentQRCode(
    studentData.id,
    'data:image/png;base64,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'
  );
  const studentFirstName = studentData.name.split(' ')[0];

  const message = {
    from: process.env.EMAIL_USER,
    to: studentData.email,
    subject: 'QRCode',
    html: '<p>Este Ã© o seu QRCode:</p><img src="cid:student_qr_code@ifpeopensource.com.br" alt="QR code">',
    attachments: [
      {
        filename: `${studentFirstName} - ${studentData.id}.png`,
        content: Buffer.from(QRCode.split(',')[1], 'base64'),
        cid: 'student_qr_code@ifpeopensource.com.br',
      },
    ],
  };

  await NodeMailer.sendEmail(message);
}

export default { sendStudentQRCodeEmail };
